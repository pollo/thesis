\documentclass[12pt,a4paper,twoside]{book}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage[font=small,labelfont=bf]{caption}
\newcommand{\norm}[1]{\lVert#1\rVert}

\bibliographystyle{alpha}
\begin{document}

\begin{titlepage}
  \begin{center}
    \begin{Large}Universit\`a degli Studi di Trento\\\end{Large}
     Facolt\`a di Scienze Matematiche, Fisiche e Naturali\\
     \vspace{10pt}
     \begin{figure}[htbp]
       \begin{center}
         \includegraphics[width=3cm]{images/sigillo_unitn.eps}
       \end{center}
     \end{figure}
Corso di Laurea in Informatica\\

\vspace{10pt}
\line(1,0){338}
\vspace{10pt}

Final Thesis\\
\end{center}
\vspace{3cm}
\begin{center}
\begin{Large}Analysis and implementation of a particle-based model for skiing traffic\\\end{Large}
\vspace{3cm}
\end{center}
Relatore interno: \\ \textbf{Prof. Alberto Montresor} \\
Relatore esterno:\hspace{6.8cm}Laureando:   \\
\textbf{Dott. Cesare Furlanello}\hspace{4.9cm}\textbf{Matteo Poletti}
\vspace{1cm}
\begin{center}
Anno accademico 2012-2013
\end{center}
\end{titlepage}
\tableofcontents
\chapter*{Introduction}
\addcontentsline{toc}{chapter}{Introduction}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{The model}\label{model}
The model implemented was proposed by Holleczek and Troster \cite{hol2012}. It can be classified as a two-dimensional microscopic-driven many-particle system with the constraint that skiers are exposed to gravity and centripetal forces.

The skiers are modeled as particles with a specific mass, $m$, that are exposed to forces. The model distinguishes between two kind of forces: the physical forces are those forces that regulate the skier motion determining the acceleration while the social forces determine the skiers behavior. In the following, the position of a particular skier at time $t$ is represented by the vector $r(t)$, $\dot{r}(t)=\frac{d}{dt}r(t)$ is his or her speed and $e_{\dot{r}}(t)=\ \dot{r}(t) / \Vert \dot{r}(t)\Vert$ the direction of motion.

\section{Social forces}
The social forces model the decisions made by a skier that is descending a slope. They are used to determine whether the skier should perform a turn, however they do not act on the acceleration. The social forces are dimensionless, the superposition of all the forces, $F_{social}$, gives the desired direction of the skier $e_{social}(t)=F_{social} / \Vert F_{social} \Vert$. If the desired direction $e_{social}(t)$ diverges from the skier direction $e_{\dot{r}}(t)$ more than an angle ${\delta}$ the skier start turning to adjust his or her direction (see Fig.\ref{start_turn_pic}).The social forces are used to model the repulsion from the edges and the obstacles, the repulsion from other skiers and to attract the skiers towards the destination chosen.

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=0.4\textwidth]{images/start_turn_pic.eps}
    \caption{(From \cite{hol2012}) When the angle between the current direction of motion $e_{\dot{r}}$ and the desired direction $e_{social}$ is bigger than $\delta$ the skier performs a turn to adjust his or her direction}\label{start_turn_pic}
  \end{center}
\end{figure}

To describe the social force that attracts the skier towards the destination chosen the model assumes that each skier, during the descent, selects several waypoints $x_a^1....x_a^n$ as temporary destinations. Thus, at each time $t$ the skier $a$ wants to reach a waypoint $x_a^k$. The direction toward the current waypoint is expressed by

\begin{equation}\label{waypoint_direction}
e_a(t)=\frac{x^k_a-r_a(t)}{\Vert x^k_a-r_a(t) \Vert}
\end{equation}
where, as defined above, $r_a(t)$ is the position of $a$ at time $t$. The social force that drives the skier toward the waypoint, the destination force, is

\begin{equation}\label{destination_force}
F_D(r_a)=A_0 e_a(t)
\end{equation}
where $A_0$ is a scaling constant that represents the strength of the destination force.

The attitude of skiers to keep a minimum distance from the edges is modeled with repulsion forces that are more stronger when the skier is closer to the edge. At each position $r_a$ the skier $a$ is subjected to a repulsion force from the left edge and to a repulsion force from the right edge. Let $r_a^L$ be the closest location to $r_a$ on the left edge, then the distance between the skier and the edge can be expressed as $r_{aL}=r_a-r_A^L$. The repulsion force from the left edge is defined as

\begin{equation}\label{left_force}
F_L(r_{aL})=-\nabla_{r_{aL}}U(\Vert r_{aL} \Vert )
\end{equation}
where $U(\Vert r_{aL} \Vert )$ is a monotonically decreasing potential. In a symmetric way the repulsion force from the right edge can be defined as

\begin{equation}\label{right_force}
F_R(r_{aR})=-\nabla_{r_{aR}}U(\Vert r_{aR} \Vert )
\end{equation}
The model takes into account also the natural behavior of avoiding collisions with other skiers. This is described by a repulsion force, referred as skier repulsion force, that each skier imposes on the other skiers. The skier repulsion force that a skier $b$ imposes on the skier $a$ can be expressed as

\begin{equation}\label{skier_force}
F_S(r_{ab})=-\nabla_{r_{ab}}V(s(r_{ab}))
\end{equation}
where $r_{ab}=r_a-r_b$ is the distance vector between the two skiers, $V(s(r_{ab}))$ is a monotonically decreasing potential with equipotential lines shaped as ellipses directed into the direction of motion and $s$ represents the semiminor axis of this ellipse and is defined as

\begin{equation}\label{skier_s}
s(r_{ab})=\frac{\sqrt{(\Vert r_{ab} \Vert + \Vert r_{ab}-v_b \Delta t e_b \Vert )^2-(v_b \Delta t)^2}}{2}
\end{equation}
Finally a repulsion force from the obstacles on the slope is considered. The force that an obstacle $o$ imposes on the skier $a$ is defined as

\begin{equation}\label{obstacle_force}
F_O(r_{ao})=-\nabla_{r_{ao}}W(\Vert r_{ao} \Vert )
\end{equation}
In general, the repulsion social forces act on the skiers only if he or she is capable of perceiving what triggers the force. The model assumes that objects are perceived only within a certain range $\varphi$ of the skier direction. $2\varphi$ can be considered as the angle of view. This is modeled by the weight

\begin{equation}\label{visibility}
w(u,v)=\begin{cases}
  1 & \text{if $(u/\Vert u \Vert)\cdot (v/\Vert v \Vert) \geq cos \varphi$} \\
  0 & \text{otherwise }
  \end{cases}
\end{equation}
To summarize, the social forces that applies on a skier $a$ are
\begin{align}\label{social_forces_tb}
F_D(r_a)&=A_0 e_a(t),\\
F_L(\dot{r_a},r_{aL})&=w(\dot{r_a},-r_{aL})F_L(r_{aL}),\\
F_R(\dot{r_a},r_{aR})&=w(\dot{r_a},-r_{aR})F_R(r_{aR}),\\
F_A(\dot{r_a},r_{ab})&=w(\dot{r_a},-r_{ab})F_A(r_{ab}),\\
F_O(\dot{r_a},r_{ao})&=w(\dot{r_a},-r_{ao})F_O(r_{ao})
\end{align}

The resultant social force $F^a_{social}$ for a skier $a$ is the superposition of all the social forces that apply on the skier:

\begin{equation}
F^a_{social}=F_D(r_a)+F_L(\dot{r_a},r_{aL})+F_R(\dot{r_a},r_{aR})+\sum_b F_A(\dot{r_a},r_{ab})+\sum_o F_O(\dot{r_a},r_{ao})\nonumber
\end{equation}
Figure \ref{social_forces_diagram} shows a diagram of the social forces described above.

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=0.8\textwidth]{images/social_forces_dia.eps}
    \caption{Diagram of the social forces. The forces $F_R$ and $F_L$ keep the skier $a$ away from the edges, the force $F_O$ repels the skier from the obstacle, the force $F_S$ repels $a$ from the skier $b$ and the force $F_D$ attracts the skier towards the waypoint.}\label{social_forces_diagram}
  \end{center}
\end{figure}


\section{Physical forces}
As described in \cite{hol2012}, there are two major techniques of performing turns: \textit{skidding} and \textit{carving}. During carving turns the direction of motion is exclusively parallel to the skis while in skidded turns there is an additional slippage to the side. Carved turns are usually performed by expert skiers, while beginners and not experienced skiers tend to perform skidded turns.

In \cite{hol2012} skiers are supposed to perform turns with a radius corresponding to the \textit{sidecut radius} of their skis. Although some studies \cite{jen2004} \cite{fe2010} have proposed a more realistic model of carving turns, investigating more deeply the effects of the penetration of the skis in the snow and of the skier tilt angle, for a first version of the model the approximation of the turning radius to the sidecut radius has been considered acceptable. Figure \ref{sidecut_radius} shows the relation between sidecut radius and turning radius.

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=0.8\textwidth]{images/sidecut_radius.eps}
    \caption{(from \cite{hol2012}) Profile of a carving sking with the sidecut radius and the turning radius evidenced.}\label{sidecut_radius}
  \end{center}
\end{figure}

Gravitational, centripetal and friction forces determine the skier acceleration according to their direction $e_{\dot{r}}$. Consider a skier at position $r$ with speed $\dot{r}$ and direction of motion $e_{\dot{r}}$ and let $n$ denote the surface normal on the ski slope at $r$. At $r$, the slope has an inclination angle of

\begin{equation}
\alpha =\arccos(\left[0,0,1\right] \cdot n)
\end{equation}
and the inclination angle $\gamma$ of the current trajectory $e_{\dot{r}}$ is

\begin{equation}
\gamma =\arcsin[(\sin \alpha )(\sin \beta )]
\end{equation}
where $\beta$ is the angle between $e_{\dot{r}}$ and the horizontal of the slope.

To compute the force accelerating the skier the gravitational force, the friction forces and the centripetal forces should be investigated. First the gravitational force $F_G$ is considered: it can be expressed as

\begin{equation}
F_G=mg\left[\begin{matrix}0\\0\\-1\end{matrix}\right]
\end{equation}
where $g$ is the gravitational acceleration and $m$ the mass of the skier. The gravitational force can be decomposed in the normal force $F_N$, acting parallel to the surface normal $n$, and in the downhill force $F_S$, acting parallel to the fall line.

\begin{equation}\label{downhill_force}
F_G=F_S-F_N
\end{equation}
The normal force $F_N$ can be expressed as
\begin{equation}
F_N=mg(\cos \alpha )n
\end{equation}
The downhill force $F_S$ itself can be decomposed into the downhill force $F_P$, acting parallel to the current trajectory $e_{\dot{r}}$, and into the lateral force $F_{lat}$ acting perpendicularly to the direction of travel (see. Fig\ref{downhill_force_pic}).

\begin{equation}
F_S=F_P+F_{lat}
\end{equation}
\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=0.5\textwidth]{images/figure5.eps}
    \caption{(from \cite{hol2012}) The downhill force $F_S$ can be decomposed into the downhill force $F_P$, acting parallel to the current trajectory, and into the lateral force $F_{lat}$ acting perpendicularly to the direction of travel.}\label{downhill_force_pic}
  \end{center}
\end{figure}

The downhill force $F_p$ can be written as
\begin{equation}
F_P=mg ( \sin \gamma ) e_{\dot{r}}=mg ( \sin \alpha ) ( \sin \beta ) e_{\dot{r}}
\end{equation}
where $\gamma$ is the inclination angle of $e_{\dot{r}}$.

Remembering \ref{downhill_force}, the downhill force $F_S$ can be computed as
\begin{equation}
F_S=F_G+F_N
\end{equation}
The lateral force $F_{lat}$ can therefore be computed as

\begin{equation}
F_{lat}=F_S-F_P
\end{equation}
The centripetal force $F_C$ a skier is exposed to during turns can be written as

\begin{equation}
F_C=\frac{m}{R_{SC}} {\norm{\dot{r}}}^2 \frac{F_{lat}}{\norm{F_{lat}}} \times
\begin{cases}
  (+1) & \text{before crossing the fall line} \\
  (-1) & \text{after crossing the fall line}
  \end{cases}
\end{equation}
where $m$ is the mass of the skier and $R_{SC}$ the sidecut radius of the skis. $F_C$ is parallel to $F_{lat}$ before the skier crosses the fall line and antiparallel to $F_{lat}$ after having crossed the fall line.

Before defining the kinetic friction of skis on snow, the effective force should be defined. The effective force is the force that has to be compensated by the snow. Its formulation depends on whether the skier is performing a turn or is descending on a straight line. In the following, when the definition of a force changes depending on whether the skier is turning, the index is written lowercase in the case of a straight line and uppercase in the case of a turn. So $F_{eff}$ is the effective force acting on a skier that is descending on a straight line and is defined as

\begin{equation}
F_{eff}=F_{lat}-F_N
\end{equation}
If the skier is performing a carved turns then the effective force $F_{EFF}$ can be written as

\begin{equation}
F_{EFF}=F_{lat}-F_C-F_N
\end{equation}
Figure \ref{effective_force_pic} shows the effective force ($F_{eff}$ and $F_{EFF}$).

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=\textwidth]{images/figure6.eps}
    \caption{(from \cite{hol2012}) In (a) effective force during the descent on a straight line ($F_{eff}=F_{lat}-F_N$). In (b) effective force during a carved turn ($F_{EFF}=F_{lat}-F_N-F_C$)}\label{effective_force_pic}
  \end{center}
\end{figure}

The kinetic friction force $F_{ground}$ can be expressed in terms of the skier's effective force as

\begin{equation}
F_{ground}=-\mu \norm{F_{eff}}e_{\dot{r}}
\end{equation}
when descending on a straight line. $\mu$ is the kinetic friction coefficient of skis on snow. In the case of a turn

\begin{equation}
F_{GROUND}=-\mu \norm{F_{EFF}}e_{\dot{r}}
\end{equation}

The air drag force $F_{air}$ is antiparallel to the direction of motion $e_{\dot{r}}$ and is defined as

\begin{equation}
F_{air}=-\frac{1}{2}C_d \rho A \norm{\dot{r}}^2 e_{\dot{r}}
\end{equation}
where $C_d$ is the drag coefficient, $\rho$ the air density and $A$ the projected frontal area of the skier perpendicular to the direction of motion.

Finally, the net force $F_{net}$ accelerating the skier can be defined as

\begin{equation}
F_{net}=-F_P + F_{air} + F_{ground}
\end{equation}
if the skier is not turning. Otherwise the force is defined as

\begin{equation}
F_{NET}=-F_P + F_{AIR} + F_{GROUND} + F_C
\end{equation}

\section{Limitations}
The model proposed describes the motion of an expert skier that is performing perfect carved turns. The turning radio has been taken constant and equals to the sidecut radius of the skis. Not experienced skiers and other snow-sport athletes are not considered. An important limitation of the model is that it does not allow skiers to stop their descent.  Moreover skiers are not allowed to jump nor to exit the ski slope. If a skier collides with an edge of the slope it is reflected back with an angle equals to the angle at which he or she has collided.

\section{Differences from the original model}
The physical model of the skiers motion has been keep equals to the one exposed in \cite{hol2012}. Between the social forces, the destination force $F_D$ (see. \ref{destination_force}) is of critical importance. Its action depends on the selection of the waypoints. In the original paper the waypoints were selected randomly every 50m, using a uniform distribution on the corresponding line from the left to the right edge of the slope (see Fig.\ref{waypoints_old_pic}).

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=\textwidth]{images/waypoint_line.eps}
    \caption{In \cite{hol2012} waypoints were selected randomly every 50m following a uniform distribution on the line from the left to the right edges of the slope.}\label{waypoints_old_pic}
  \end{center}
\end{figure}

A more dynamical approach in the selection of the waypoints has been considered to better model the choices that a skier takes descending a slope. The new strategy allow each skier to dynamically choose waypoints during the descent, basing on the position of the skier, on the shape of the trail, on the slope of the terrain and on the skier velocity.

In the following the new mechanism for the waypoints selection is explained. Let $a$ be a skier at position $r_a$, let $r_a^L$ be the location on the left slope edge closest to $r_a$ and $r_a^R$ the location on the right slope edge closest to $r$. Then the vectors given the direction toward the edges are $e_{aR}=\left(r_a^L-r_a\right)/\norm{r_a^L-r_a}$ and $e_{aL}=\left(r_a^R-r_a\right)/\norm{r_a^R-r_a}$. Let $\alpha$ be the angle between $e_{aR}$ and $e_{aL}$ defined as

\begin{equation}
\alpha=\begin{cases}
  \arccos(e_{aR} \cdot e_{aL}) & \text{if(($e_{aR} \times e_{aL})\cdot n \ge 0$)} \\
  2\pi-\arccos(e_{aR} \cdot e_{aL}) & \text{if(($e_{aR} \times e_{aL})\cdot n < 0$)}
\end{cases}
\end{equation}
where $n$ is the normal of the plane containing $e_{aR}$ and $e_{aL}$. The skier $a$ chooses the new waypoint with uniform distribution on a fraction of the angle $\alpha$. More precisely, let $\delta$ be the fraction of angle that should be considered, then the new waypoint $w_a$ is chosen as

\begin{equation}\label{new_waypoint}
w_a=r_a+\rho F\left(\frac{e_{aR}+e_{aL}}{\norm{e_{aR}+e_{aL}}},\mathcal{U}\left(-\frac{\alpha\delta}{2},\frac{\alpha\delta}{2}\right)\right)
\end{equation}
where $\rho$ is the distance at which waypoint are chosen, $F\left(v,\beta\right)$ rotates the vector $v$ of an angle $\beta$ and $\mathcal{U}(a,b)$ returns a random number with uniform distribution on $(a,b)$ (see Fig.\ref{new_waypoint_pic}).

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=\textwidth]{images/waypoint_new.eps}
    \caption{Selection of a waypoint: the skier $a$ selects the new waypoint $w$ choosing with uniform distribution on the angle $\delta\alpha$, a fraction of $\alpha$. The angle $\alpha$ is the angle between $e_{aR}$, the vector representing the direction towards the right edge, and $e_{aL}$, the vector towards the left edge,}\label{new_waypoint_pic}
  \end{center}
\end{figure}

A new waypoint is selected when the old waypoint is no longer feasible, meaning that it is not in the interval that the skier would consider choosing a new waypoint, or when the skier has traveled more than $D$ meters after having chosen the last waypoint.

Designing the new mechanism to the selection of waypoints some requirements it should satisfy has been individuated:\begin{enumerate}
\item \label{depending_velocity} Speed should influence the choice of the new waypoint: when skiers are traveling fast they tend to perform more turns than when the speed is low.
\item \label{depending_slope} The selection of the new waypoint should depend on the slope that the skier is going to encounter: before flat areas skiers tend to avoid turns to increase their velocity.
\item \label{frequency} The frequency of the selection of new waypoints should depend on the skiers speed, the more skiers are traveling fast, the more frequently they will choose new waypoints.
\item \label{avoid_impact} Skiers usually avoid to choose a direction that would make them pass the edge of the slope. Therefore, the new waypoint should be in a position that does not lead the skier to impact the edge of the slope.
\end{enumerate}

To fulfill this requirements it is possible to act on the parameter $\delta$ of the equation \ref{new_waypoint}. When $\delta$ is increasing, the width of the angle in which new waypoints can be chosen becomes larger. As a consequence the probability of performing turns becomes higher.

Requirement \ref{depending_velocity} can be satisfied by making the parameter $\delta$ depend linear on the speed $v$ of the skier. Moreover it is required that when the speed $v$ is near $0$ then the width of the angle should be itself near to $0$ and when $v$ is near to a value of speed considered high $v_{max}$ the angle should have maximum width. Therefore, $\delta$ can be set to
\begin{equation}\label{delta_vel}
\delta= \frac{v}{v_{max}}
\end{equation}

To fulfill the requirement \ref{depending_slope} an additional factor depending on the slope should be considered. Let $s$ be the slope that the skier is going to encounter and let $s_{lim}$ a value of slope that is considered small enough to require an additional acceleration by the skier. Then if $s<s_{lim}$ the width of the angle in which to choose the new waypoint should be narrowed again. Taking into account \ref{delta_vel} then we can write $\delta$ as

\begin{equation}
\delta=\begin{cases}
   \frac{v}{v_{max}}\frac{s}{s_{lim}} & \text{if ($s < s_{lim}$)} \\
   \frac{v}{v_{max}} & \text{otherwise}
\end{cases}
\end{equation}
If, despite this, the skiers will come to a complete halt (maybe due to a counter slope), they will start walking at constant speed.

The requirement \ref{frequency} is already met by the mechanism described above. In fact, since a new waypoint is chosen each time the skier has traveled more than $D$ meters, when a skier is faster he or she chooses waypoints more frequently.

Finally, to satisfy the requirement \ref{avoid_impact} manipulating $\delta$ is not enough. The minimum turning radius of the skiers gives a bound to their capacity of avoiding a collision and of avoiding the edges of the ski slope. Assuming that a skier do not choose a direction that will make them exit the ski slope, those angles indicating a direction along which the slope edge is reached in less than $R_{SC}$ meters are not considered in the selection of the waypoint.

\bibliography{thesis}
\end{document}
